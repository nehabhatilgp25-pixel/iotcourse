<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ninja IoT Dashboard</title>
<style>
body { background-color: rgb(208,255,207); font-family: Arial, sans-serif; text-align: center; }
.card { background-color: rgb(23,115,21); color: white; padding: 20px; margin: 10px auto; border-radius: 12px; width: 250px; min-height: 120px; }
.disabled { background-color: lightgray !important; pointer-events: none; }
button { padding: 10px 20px; font-size: 16px; border-radius: 8px; cursor: pointer; }
</style>
</head>
<body>
<h1>Ninja IoT Dashboard</h1>

<div class="card" id="ledCard">
  <h2>LED</h2>
  <button id="ledToggle">OFF</button>
</div>

<div class="card" id="distanceCard">
  <h2>Distance</h2>
  <p id="distanceStatus">Loading...</p>
</div>

<div class="card">
  <h2>Mode</h2>
  <select id="modeSelect">
    <option value="0">Automatic</option>
    <option value="1">Manual</option>
  </select>
</div>

<script>
const UID = "NB09";
const BASE_URL = "https://iot.roboninja.in/index.php?";

const ledToggle = document.getElementById("ledToggle");
const distanceStatus = document.getElementById("distanceStatus");
const modeSelect = document.getElementById("modeSelect");
const ledCard = document.getElementById("ledCard");

// Poll device
async function pollDevice() {
  try {
    const [d2, d5, d6] = await Promise.all([
      fetch(`${BASE_URL}action=read&UID=${UID}&D2`).then(r=>r.text()),
      fetch(`${BASE_URL}action=read&UID=${UID}&D5`).then(r=>r.text()),
      fetch(`${BASE_URL}action=read&UID=${UID}&D6`).then(r=>r.text())
    ]);

    // Update distance
    distanceStatus.innerText = (parseInt(d2) === 0) ? "Object blocking path" : "Pathway clear";

    // Update LED state
    ledToggle.innerText = (parseInt(d5) === 1) ? "ON" : "OFF";

    // Update mode dropdown
    modeSelect.value = d6;
    if (parseInt(d6) === 0) {
      ledCard.classList.add("disabled");
      ledToggle.disabled = true;
    } else {
      ledCard.classList.remove("disabled");
      ledToggle.disabled = false;
    }
  } catch (err) {
    console.error("Error polling device:", err);
  }
}

// Manual LED toggle
ledToggle.addEventListener("click", async () => {
  if (parseInt(modeSelect.value) === 1) {
    const newState = (ledToggle.innerText === "OFF") ? 1 : 0;
    await fetch(`${BASE_URL}action=write&UID=${UID}&D5=${newState}`);
  }
});

// Mode change
modeSelect.addEventListener("change", async () => {
  const mode = modeSelect.value;
  await fetch(`${BASE_URL}action=write&UID=${UID}&D6=${mode}`);
});

// Poll every second
setInterval(pollDevice, 1000);
</script>
</body>
</html>
